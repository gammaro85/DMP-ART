<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>DMP ART Documentation</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/dmp-art-favicon (Niestandardowe).png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        (function() {
            const saved = localStorage.getItem('dmp-art-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
            const meta = document.querySelector('meta[name="theme-color"]');
            if (meta) meta.content = theme === 'dark' ? '#121212' : '#ffffff';
        })();
    </script>
    <style>
        .doc-container {
            max-width: 960px;
            margin: 0 auto;
            padding: 2rem;
        }

        .doc-header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: var(--shadow-light);
        }

        .doc-header h1 {
            margin: 1rem 0 0.5rem;
            color: var(--text-primary);
        }

        .doc-header p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 0.2rem 0.65rem;
            border-radius: 10px;
            font-size: 0.78rem;
            font-weight: 500;
            margin: 0.2rem;
        }

        .badge.success { background: var(--success-color); }
        .badge.warning { background: var(--warning-color); }

        .doc-section {
            background: var(--bg-card);
            margin-bottom: 1.5rem;
            padding: 1.75rem 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
        }

        .doc-section h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.4rem;
            margin-bottom: 1.25rem;
            font-size: 1.15rem;
        }

        .doc-section h3 {
            color: var(--text-primary);
            font-size: 1rem;
            margin: 1.25rem 0 0.5rem;
        }

        .doc-section p, .doc-section li {
            color: var(--text-secondary);
            line-height: 1.65;
        }

        .doc-section ul {
            padding-left: 1.25rem;
            margin: 0.5rem 0;
        }

        .doc-section li {
            margin-bottom: 0.3rem;
        }

        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .quick-card {
            background: var(--bg-secondary);
            border-left: 3px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem 1.25rem;
        }

        .quick-card h4 {
            color: var(--primary-color);
            margin: 0 0 0.5rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .quick-card p, .quick-card li {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .quick-card ul {
            padding-left: 1.1rem;
            margin: 0.4rem 0 0;
        }

        .code-block {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 0.9rem 1rem;
            font-family: var(--font-family-mono);
            font-size: 0.85rem;
            margin: 0.75rem 0;
            overflow-x: auto;
            white-space: pre;
        }

        .workflow-row {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .workflow-step {
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.88rem;
            font-weight: 500;
        }

        .workflow-arrow {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .info-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 0.75rem 0;
        }

        .info-box.warning {
            border-left: 3px solid var(--warning-color);
        }

        .info-box.tip {
            border-left: 3px solid var(--success-color);
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .github-link:hover {
            text-decoration: underline;
        }

        .toc {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
        }

        .toc h3 {
            margin: 0 0 0.75rem;
            color: var(--primary-color);
            font-size: 0.95rem;
        }

        .toc ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.25rem;
        }

        .toc a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            display: block;
            transition: background 0.15s;
        }

        .toc a:hover, .toc a.active {
            background: var(--primary-color);
            color: white;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 0.75rem 0;
        }

        @media (max-width: 640px) {
            .two-col { grid-template-columns: 1fr; }
            .quick-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-page="documentation">
    <header class="fixed-header">
        <nav class="header-nav">
            <button class="theme-toggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <div class="nav-links">
                <a href="/" class="nav-item" data-page="index">Home</a>
                <span class="nav-item disabled" data-page="review"
                      title="Upload and process a document first to access review">Review</span>
                <a href="/template_editor" class="nav-item" data-page="template-editor">Configuration</a>
                <a href="/ai-settings" class="nav-item" data-page="ai-settings">AI Settings</a>
                <a href="/documentation" class="nav-item" data-page="documentation">Documentation</a>
            </div>
        </nav>
    </header>

    <div class="doc-container">
        <header class="doc-header">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='images/dmp-art-logo-main-light.png') }}"
                     alt="DMP ART Logo" class="logo light-logo" loading="lazy">
                <img src="{{ url_for('static', filename='images/dmp-art-logo-main-dark.png') }}"
                     alt="DMP ART Logo" class="logo dark-logo" loading="lazy">
            </div>
            <h1>DMP ART Documentation</h1>
            <p>Data Management Plan Assessment and Response Tool</p>
            <div>
                <span class="badge success">v0.9.0</span>
                <span class="badge">94.1% success rate</span>
                <span class="badge warning">Active development</span>
            </div>
        </header>

        <div class="toc">
            <h3><i class="fas fa-list"></i> Contents</h3>
            <ul>
                <li><a href="#quickstart">Quick Start</a></li>
                <li><a href="#workflow">How It Works</a></li>
                <li><a href="#features">Key Features</a></li>
                <li><a href="#comments-lang">Comments &amp; Language</a></li>
                <li><a href="#configuration">Configuration</a></li>
                <li><a href="#advanced">Advanced / Self-hosting</a></li>
                <li><a href="#limitations">Known Limitations</a></li>
                <li><a href="#contribute">Contribute &amp; Issues</a></li>
            </ul>
        </div>

        <main>

            <!-- Quick Start -->
            <section id="quickstart" class="doc-section">
                <h2><i class="fas fa-rocket"></i> Quick Start</h2>
                <p>DMP ART automates the review of Data Management Plans from NCN/OSF grant proposals. Upload a file, get a structured 14-section breakdown, write feedback with pre-built comment templates.</p>

                <div class="workflow-row">
                    <span class="workflow-step">1. Upload PDF/DOCX</span>
                    <span class="workflow-arrow">→</span>
                    <span class="workflow-step">2. Extraction (auto)</span>
                    <span class="workflow-arrow">→</span>
                    <span class="workflow-step">3. Review sections</span>
                    <span class="workflow-arrow">→</span>
                    <span class="workflow-step">4. Export feedback</span>
                </div>

                <div class="info-box tip">
                    <strong>New user?</strong> Just drag and drop your NCN proposal (PDF or DOCX, max 16 MB) onto the home page. The tool handles the rest — extraction takes 10–30 seconds.
                </div>

                <h3>System Requirements</h3>
                <ul>
                    <li>Python 3.8+ with dependencies from <code>requirements.txt</code></li>
                    <li>Modern browser (Chrome/Firefox/Edge 90+), desktop only</li>
                    <li>Optional: Tesseract OCR 5.3+ for scanned PDFs (<code>tesseract-ocr-pol tesseract-ocr-eng</code>)</li>
                </ul>

                <div class="code-block">pip install -r requirements.txt
python app.py          # open http://localhost:5000</div>

                <p>For Docker and production deployment details, see the
                    <a class="github-link" href="https://github.com/gammaro85/DMP-ART" target="_blank" rel="noopener">
                        <i class="fab fa-github"></i> README on GitHub
                    </a>.
                </p>
            </section>

            <!-- Workflow -->
            <section id="workflow" class="doc-section">
                <h2><i class="fas fa-cogs"></i> How It Works</h2>

                <div class="two-col">
                    <div>
                        <h3>Document Processing</h3>
                        <ul>
                            <li>PDF → PyPDF2 text extraction, with Tesseract OCR fallback for scanned files</li>
                            <li>DOCX → python-docx with table and formatting support</li>
                            <li>4-tier section detection: bold markers → numbered headings → formatted text → fuzzy matching (Jaccard 0.6)</li>
                        </ul>
                    </div>
                    <div>
                        <h3>Extraction Output</h3>
                        <ul>
                            <li>14 Science Europe sections (1.1–6.2) split and tagged</li>
                            <li>Unrecognized text collected as "Unconnected Text"</li>
                            <li>Results cached as UUID JSON in <code>outputs/cache/</code></li>
                            <li>Bilingual detection: Polish and English DMP formats</li>
                        </ul>
                    </div>
                </div>

                <div class="info-box warning">
                    <strong>Extraction accuracy:</strong> 94.1% on 17 real NCN proposals. Always verify extracted content against the original document, especially for heavily formatted or scanned files.
                </div>
            </section>

            <!-- Key Features -->
            <section id="features" class="doc-section">
                <h2><i class="fas fa-star"></i> Key Features</h2>

                <div class="quick-grid">
                    <div class="quick-card">
                        <h4><i class="fas fa-comments"></i> Review Interface</h4>
                        <ul>
                            <li>Section-by-section feedback with textarea per section</li>
                            <li>Category comment buttons (For Newbies, Missing Info, Ready to Use)</li>
                            <li>Quick Comments sidebar for reusable snippets</li>
                            <li>Progress tracking, save &amp; resume</li>
                        </ul>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-language"></i> PL / EN Comments</h4>
                        <ul>
                            <li>Switch comment language (PL/EN) in the header on Review and Configuration pages</li>
                            <li>Each category has a separate <code>_pl.json</code> and <code>_en.json</code> file</li>
                            <li>Language preference saved in browser storage</li>
                        </ul>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-edit"></i> Configuration</h4>
                        <ul>
                            <li>Edit DMP section structure (questions, order)</li>
                            <li>Add / edit / delete Quick Comments</li>
                            <li>Create custom feedback categories</li>
                            <li>All changes persist in <code>config/*.json</code></li>
                        </ul>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-robot"></i> AI Assistant (optional)</h4>
                        <ul>
                            <li>OpenAI or Anthropic API integration</li>
                            <li>75% ready comments + 25% AI suggestions</li>
                            <li>Auto-learning knowledge base</li>
                            <li>Configure at <a href="/ai-settings">/ai-settings</a></li>
                        </ul>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-palette"></i> Dark / Light Theme</h4>
                        <ul>
                            <li>Auto-detects system preference</li>
                            <li>Toggle button in top-left header</li>
                            <li>Keyboard shortcut: <code>Ctrl+Shift+D</code></li>
                            <li>Preference saved in browser storage</li>
                        </ul>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-download"></i> Export</h4>
                        <ul>
                            <li>Compile all section feedback into one report</li>
                            <li>Export as TXT</li>
                            <li>Save progress (resume later)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Comments & Language -->
            <section id="comments-lang" class="doc-section">
                <h2><i class="fas fa-language"></i> Comments &amp; Language</h2>

                <p>The language switcher (<strong>PL / EN</strong>) on the <em>Review</em> and <em>Configuration</em> pages controls which language variant of the comment files is loaded. It does <strong>not</strong> translate the interface.</p>

                <h3>File structure</h3>
                <p>Each feedback category has two language files in <code>config/</code>:</p>
                <div class="code-block">config/
├── for_newbies_pl.json      # Guidance comments – Polish
├── for_newbies_en.json      # Guidance comments – English
├── missing_info_pl.json     # Missing-info comments – Polish
├── missing_info_en.json     # Missing-info comments – English
├── ready_to_use_pl.json     # Ready-to-use examples – Polish
├── ready_to_use_en.json     # Ready-to-use examples – English
└── quick_comments.json      # Quick Comments (bilingual keys: en/pl)</div>

                <h3>Adding your own language-specific category</h3>
                <p>Create two files: <code>config/mycategory_pl.json</code> and <code>config/mycategory_en.json</code> with the standard structure:</p>
                <div class="code-block">{
  "1.1": ["Comment for section 1.1", "Another comment"],
  "1.2": ["Comment for section 1.2"],
  ...
}</div>
                <p>Restart the app — the new category appears automatically in Review and Configuration pages.</p>

                <div class="info-box tip">
                    <strong>User-created categories</strong> (via Configuration → new button) are single-language by default. To add a language variant, manually create the <code>_pl</code> or <code>_en</code> file.
                </div>
            </section>

            <!-- Configuration -->
            <section id="configuration" class="doc-section">
                <h2><i class="fas fa-cog"></i> Configuration</h2>

                <p>All configuration is file-based — no database. Open <a href="/template_editor">Configuration</a> in the app, or edit JSON files directly.</p>

                <div class="two-col">
                    <div>
                        <h3>Via UI (Configuration page)</h3>
                        <ul>
                            <li><strong>DMP Structure</strong> — section order and questions</li>
                            <li><strong>Quick Comments</strong> — reusable snippets (bilingual)</li>
                            <li><strong>Category tabs</strong> — edit comments per section</li>
                            <li><strong>+ new</strong> button — create custom categories</li>
                        </ul>
                    </div>
                    <div>
                        <h3>Config files (advanced)</h3>
                        <ul>
                            <li><code>config/dmp_structure.json</code> — section hierarchy</li>
                            <li><code>config/quick_comments.json</code> — quick comment templates</li>
                            <li><code>config/*_pl.json</code>, <code>*_en.json</code> — category comments</li>
                            <li><code>config/ai/ai_config.json</code> — AI settings &amp; API keys</li>
                        </ul>
                    </div>
                </div>

                <div class="info-box tip">
                    Changes to category JSON files are picked up after reloading the page (no server restart needed for most settings).
                </div>
            </section>

            <!-- Advanced -->
            <section id="advanced" class="doc-section">
                <h2><i class="fas fa-server"></i> Advanced / Self-hosting</h2>

                <h3>Production deployment</h3>
                <div class="code-block">pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app</div>

                <h3>Docker (recommended)</h3>
                <div class="code-block">FROM python:3.11-slim
RUN apt-get update && apt-get install -y \
    tesseract-ocr tesseract-ocr-pol tesseract-ocr-eng poppler-utils
COPY . /app
WORKDIR /app
RUN pip install -r requirements.txt
CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "app:app"]</div>

                <h3>Key directories</h3>
                <ul>
                    <li><code>uploads/</code> — temporary upload storage (auto-cleaned)</li>
                    <li><code>outputs/cache/</code> — UUID-based extraction cache</li>
                    <li><code>outputs/dmp/</code> — extracted DMP files</li>
                    <li><code>outputs/reviews/</code> — saved feedback</li>
                </ul>

                <p>For full technical documentation, architecture decisions and API routes, see the
                    <a class="github-link" href="https://github.com/gammaro85/DMP-ART" target="_blank" rel="noopener">
                        <i class="fab fa-github"></i> project repository
                    </a>.
                </p>
            </section>

            <!-- Known Limitations -->
            <section id="limitations" class="doc-section">
                <h2><i class="fas fa-exclamation-triangle"></i> Known Limitations</h2>

                <div class="quick-grid">
                    <div class="quick-card">
                        <h4><i class="fas fa-user"></i> Single-user</h4>
                        <p>No authentication, no multi-user collaboration. Designed for one data steward at a time.</p>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-file-alt"></i> NCN/OSF format</h4>
                        <p>Optimised for standard OSF exports. Non-standard layouts or very heavily formatted documents may need manual review.</p>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-table"></i> Complex tables</h4>
                        <p>Merged cells and complex table structures may not extract cleanly. Check "Unconnected Text" for missed content.</p>
                    </div>
                    <div class="quick-card">
                        <h4><i class="fas fa-download"></i> Export formats</h4>
                        <p>Currently TXT export only. DOCX/PDF export is planned.</p>
                    </div>
                </div>

                <div class="info-box warning">
                    <strong>Scanned PDFs:</strong> Require Tesseract OCR to be installed (<code>tesseract-ocr-pol</code> + <code>tesseract-ocr-eng</code>). Without it, scanned files will produce no extracted text.
                </div>
            </section>

            <!-- Contribute -->
            <section id="contribute" class="doc-section">
                <h2><i class="fab fa-github"></i> Contribute &amp; Issues</h2>

                <p>DMP ART is open-source under the <strong>MIT License</strong>.</p>

                <div class="two-col">
                    <div>
                        <h3>Report a bug or request a feature</h3>
                        <p>Open an issue on GitHub:</p>
                        <a class="github-link" href="https://github.com/gammaro85/DMP-ART/issues" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i> github.com/gammaro85/DMP-ART/issues
                        </a>
                    </div>
                    <div>
                        <h3>Source code &amp; full docs</h3>
                        <a class="github-link" href="https://github.com/gammaro85/DMP-ART" target="_blank" rel="noopener">
                            <i class="fab fa-github"></i> github.com/gammaro85/DMP-ART
                        </a>
                        <p style="margin-top: 0.5rem; font-size: 0.88rem;">Includes <code>CLAUDE.md</code>, <code>HISTORY.md</code>, and full technical documentation for developers and AI agents.</p>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script src="{{ url_for('static', filename='js/dark-mode.js') }}"></script>
    <script>
        // Smooth scrolling for TOC
        document.querySelectorAll('.toc a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const el = document.getElementById(this.getAttribute('href').substring(1));
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Active TOC highlight on scroll
        window.addEventListener('scroll', function() {
            const scrollPos = window.scrollY + 120;
            document.querySelectorAll('section[id]').forEach(section => {
                const top = section.offsetTop;
                const bottom = top + section.offsetHeight;
                const id = section.id;
                if (scrollPos >= top && scrollPos <= bottom) {
                    document.querySelectorAll('.toc a').forEach(a => a.classList.remove('active'));
                    const active = document.querySelector(`.toc a[href="#${id}"]`);
                    if (active) active.classList.add('active');
                }
            });
        });

        // Theme icon sync
        document.addEventListener('DOMContentLoaded', function() {
            function updateThemeIcon() {
                const btn = document.querySelector('.theme-toggle i');
                if (!btn) return;
                btn.className = document.documentElement.getAttribute('data-theme') === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }
            updateThemeIcon();
            window.toggleTheme = function() {
                const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem('dmp-art-theme', next);
                updateThemeIcon();
            };
        });
    </script>

    <footer class="site-footer site-footer--relative">
        <span>DMP ART &copy; 2025 — <a href="https://github.com/gammaro85/DMP-ART" target="_blank" rel="noopener" style="color: inherit;">MIT License</a></span>
    </footer>
</body>
</html>
