<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMP ART</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script>
        // Prevent flash of wrong theme
        (function() {
            const savedTheme = localStorage.getItem('dmp-art-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <style>
        :root {
            /* ...remove or override local variables, rely on style.css... */
        }
        [data-theme="dark"] {
            /* ...remove or override local variables, rely on style.css... */
        }
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.2s, color 0.2s;
        }
        .container {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        .primary-btn, .secondary-btn, .download-btn {
            transition: background 0.2s, color 0.2s;
        }
        .primary-btn {
            background: var(--primary-color);
            color: #fff;
        }
        .secondary-btn {
            background: var(--secondary-color);
            color: #fff;
        }
        .primary-btn:hover, .secondary-btn:hover {
            opacity: 0.85;
        }
        .footer-content {
            background: var(--bg-alt);
            color: var(--text-secondary);
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-alt);
            color: var(--text-main);
            border: 1px solid var(--secondary-color);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s, color 0.2s;
        }
        .theme-toggle:hover {
            background: var(--secondary-color);
            color: #fff;
        }
        /* Add gap below the upload instruction and above the Select File button */
        #select-file-btn {
            margin-top: 1rem;
        }
        @media (max-width: 768px) {
            .theme-toggle {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon"></span>
        <span id="theme-text">Dark Mode</span>
    </div>
    <div class="container">
        <header>
            <h1>DMP ART</h1>
            <h2>Data Management Plan Assessment and Response Tool</h2>
        </header>
        
        <main>
            <div class="upload-container">
                <div id="drop-area">
                    <form id="upload-form" enctype="multipart/form-data">
                        <p>Upload PDF or DOCX files by dragging and dropping or clicking below</p>
                        <input type="file" id="file-input" name="file" accept=".pdf,.docx" hidden>
                        <button type="button" id="select-file-btn">Select File</button>
                    </form>
                    <div id="file-info" class="hidden">
                        <p id="file-name"></p>
                        <button id="upload-btn" class="primary-btn">Extract & Review DMP</button>
                        <button id="clear-btn" class="secondary-btn">Clear</button>
                    </div>
                </div>
            </div>
            
            <div id="loading" class="hidden">
                <div class="spinner"></div>
                <p>Processing file...</p>
            </div>
            
            <div id="result" class="hidden">
                <div id="success-message" class="hidden">
                    <h2>Extraction Successful!</h2>
                    <p>Your DMP has been extracted and is ready for review.</p>
                    <div class="button-group">
                        <a id="review-link" href="#" class="primary-btn">Review DMP</a>
                        <a id="download-link" href="#" class="download-btn">Download Word Document</a>
                    </div>
                    <button id="new-upload-btn" class="secondary-btn">Process Another File</button>
                </div>
                
                <div id="error-message" class="hidden">
                    <h2>Extraction Failed</h2>
                    <p id="error-text"></p>
                    <button id="try-again-btn" class="secondary-btn">Try Again</button>
                </div>
            </div>
        </main>
        
        <footer>
            <div class="footer-content">
                <div class="footer-main">
                    <p>DMP ART &copy; 2025</p>
                </div>
                <div class="footer-links">
                    <a href="/template_editor" class="footer-link secondary-btn" style="margin: 0;">Customize Templates</a>
                    <a href="/documentation" class="footer-link secondary-btn" style="margin: 0;">Documentation</a>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // Theme toggle logic
        (function() {
            const root = document.documentElement;
            const themeToggle = () => {
                const current = root.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                root.setAttribute('data-theme', next);
                localStorage.setItem('dmp-art-theme', next);
                updateThemeToggle(next === 'dark');
            };
            window.toggleTheme = themeToggle;
            function updateThemeToggle(isDark) {
                const icon = document.getElementById('theme-icon');
                const text = document.getElementById('theme-text');
                if (icon && text) {
                    if (isDark) {
                        icon.textContent = '⚪';
                        text.textContent = 'Light Mode';
                    } else {
                        icon.textContent = '⚫';
                        text.textContent = 'Dark Mode';
                    }
                }
            }
            // Set theme on load
            const saved = localStorage.getItem('dmp-art-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            root.setAttribute('data-theme', theme);
            updateThemeToggle(theme === 'dark');
            // Listen for system changes if no saved theme
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('dmp-art-theme')) {
                    const newTheme = e.matches ? 'dark' : 'light';
                    root.setAttribute('data-theme', newTheme);
                    updateThemeToggle(newTheme === 'dark');
                }
            });
        })();
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>