{
  "_metadata": {
    "version": "1.0",
    "description": "Extraction rules for DMP content detection and filtering",
    "last_updated": "2025-12-13T00:00:00",
    "rule_count": 127
  },

  "_schema_version": "1.0",

  "skip_patterns": {
    "general": {
      "description": "Content to skip in all document types",
      "enabled": true,
      "patterns": [
        {"id": "skip_001", "pattern": "Strona \\d+", "description": "Polish page numbers", "enabled": true},
        {"id": "skip_002", "pattern": "Page \\d+", "description": "English page numbers", "enabled": true},
        {"id": "skip_003", "pattern": "ID:\\s*\\d+", "description": "Document IDs", "enabled": true},
        {"id": "skip_004", "pattern": "\\[wydruk roboczy\\]", "description": "Working print marker", "enabled": true},
        {"id": "skip_005", "pattern": "WZÓR", "description": "Template marker", "enabled": true},
        {"id": "skip_006", "pattern": "W Z Ó R", "description": "Template marker (spaced)", "enabled": true},
        {"id": "skip_007", "pattern": "OSF,", "description": "Grant system name", "enabled": true},
        {"id": "skip_008", "pattern": "^\\d+$", "description": "Pure numbers", "enabled": true},
        {"id": "skip_009", "pattern": "^\\+[-=]+\\+$", "description": "Table borders", "enabled": true},
        {"id": "skip_010", "pattern": "^\\|[\\s\\|]*\\|$", "description": "Table separators", "enabled": true},
        {"id": "skip_011", "pattern": "Dół formularza", "description": "Form bottom (Polish)", "enabled": true},
        {"id": "skip_012", "pattern": "Początek formularza", "description": "Form top (Polish)", "enabled": true},
        {"id": "skip_013", "pattern": "^\\s*Dół\\s+formularza\\s*$", "description": "Form bottom with spacing", "enabled": true},
        {"id": "skip_014", "pattern": "^\\s*Początek\\s+formularza\\s*$", "description": "Form top with spacing", "enabled": true}
      ]
    },

    "pdf_specific": {
      "description": "Skip patterns only for PDF files",
      "enabled": true,
      "patterns": [
        {"id": "pdf_skip_001", "pattern": "wydruk roboczy", "description": "Working print", "enabled": true},
        {"id": "pdf_skip_002", "pattern": "Strona \\d+ z \\d+", "description": "Page X of Y", "enabled": true},
        {"id": "pdf_skip_003", "pattern": "TAK\\s*NIE\\s*$", "description": "YES NO checkbox", "enabled": true},
        {"id": "pdf_skip_004", "pattern": "^\\s*[✓✗×]\\s*$", "description": "Checkmarks", "enabled": true},
        {"id": "pdf_skip_005", "pattern": "^\\s*\\[\\s*[Xx]?\\s*\\]\\s*$", "description": "Checkbox brackets", "enabled": true},
        {"id": "pdf_skip_006", "pattern": "^\\s*_{3,}\\s*$", "description": "Form field underscores", "enabled": true},
        {"id": "pdf_skip_007", "pattern": "^\\.{3,}$", "description": "Form field dots", "enabled": true},
        {"id": "pdf_skip_008", "pattern": "^\\s*data\\s*:\\s*$", "description": "Date label", "enabled": true},
        {"id": "pdf_skip_009", "pattern": "^\\s*podpis\\s*:\\s*$", "description": "Signature label", "enabled": true},
        {"id": "pdf_skip_010", "pattern": "OSF,?\\s*OPUS-\\d+\\s*Strona\\s+\\d+\\s*ID:\\s*\\d+,?\\s*\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}", "description": "Complex header line", "enabled": true},
        {"id": "pdf_skip_011", "pattern": "OSF,?\\s*OPUS-\\d+\\s*Strona", "description": "OPUS header fragment", "enabled": true},
        {"id": "pdf_skip_012", "pattern": "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}", "description": "Timestamps", "enabled": true}
      ]
    },

    "docx_specific": {
      "description": "Skip patterns only for DOCX files",
      "enabled": true,
      "patterns": []
    }
  },

  "prefix_strip_rules": {
    "description": "Remove prefixes from content before processing (fixes section detection)",
    "enabled": true,
    "global_rules": [
      {"id": "strip_001", "pattern": "^BOLD:\\s*", "description": "Remove BOLD: prefix", "enabled": true},
      {"id": "strip_002", "pattern": "^ITALIC:\\s*", "description": "Remove ITALIC: prefix", "enabled": true},
      {"id": "strip_003", "pattern": "^UNDERLINED:\\s*", "description": "Remove UNDERLINED: prefix", "enabled": true},
      {"id": "strip_004", "pattern": "^UNDERLINE:\\s*", "description": "Remove UNDERLINE: prefix", "enabled": true}
    ],
    "per_section_rules": {
      "1.1": [],
      "1.2": [],
      "2.1": [],
      "2.2": [],
      "3.1": [],
      "3.2": [],
      "4.1": [],
      "4.2": [],
      "5.1": [],
      "5.2": [],
      "5.3": [],
      "5.4": [],
      "6.1": [],
      "6.2": []
    }
  },

  "suffix_strip_rules": {
    "description": "Remove suffixes from content before processing",
    "enabled": true,
    "global_rules": [],
    "per_section_rules": {}
  },

  "inline_strip_rules": {
    "description": "Remove inline patterns from content (footnote references, etc.)",
    "enabled": true,
    "global_rules": [
      {"id": "inline_001", "pattern": "\\[\\d+\\]", "description": "Footnote references [1], [2]", "enabled": true},
      {"id": "inline_002", "pattern": "\\(\\d+\\)", "description": "Footnote references (1), (2)", "enabled": true},
      {"id": "inline_003", "pattern": "[⁰¹²³⁴⁵⁶⁷⁸⁹]+", "description": "Superscript numbers", "enabled": true}
    ],
    "per_section_rules": {}
  },

  "boundary_markers": {
    "description": "Markers indicating start/end of DMP section in document",
    "start_markers": [
      {"pattern": "DATA MANAGEMENT PLAN", "language": "en", "enabled": true},
      {"pattern": "DATA MANAGEMENT PLAN \\[in English\\]", "language": "en", "enabled": true},
      {"pattern": "PLAN ZARZĄDZANIA DANYMI", "language": "pl", "enabled": true}
    ],
    "end_markers": [
      {"pattern": "ADMINISTRATIVE DECLARATIONS", "language": "en", "enabled": true},
      {"pattern": "OŚWIADCZENIA ADMINISTRACYJNE", "language": "pl", "enabled": true}
    ]
  },

  "section_detection": {
    "description": "Rules for detecting main sections (1, 2, 3, 4, 5, 6)",
    "tier_1_pdf_form_patterns": {
      "description": "Used only for PDF files - detect form-style sections",
      "enabled": true,
      "patterns": [
        {"pattern": "PLAN\\s+ZARZĄDZANIA\\s+DANYMI", "language": "pl"},
        {"pattern": "DATA\\s+MANAGEMENT\\s+PLAN", "language": "en"},
        {"pattern": "Opis\\s+danych\\s+oraz\\s+pozyskiwanie", "language": "pl"},
        {"pattern": "Dokumentacja\\s+i\\s+jakość\\s+danych", "language": "pl"},
        {"pattern": "Przechowywanie\\s+i\\s+tworzenie\\s+kopii", "language": "pl"},
        {"pattern": "Wymogi\\s+prawne", "language": "pl"},
        {"pattern": "Udostępnianie\\s+i\\s+długotrwałe", "language": "pl"},
        {"pattern": "Zadania\\s+związane\\s+z\\s+zarządzaniem", "language": "pl"}
      ]
    },
    "tier_2_numbered_sections": {
      "description": "Detect numbered sections like '1. Section title'",
      "enabled": true,
      "pattern": "^\\s*(\\d+)\\.\\s*(.*?)$",
      "similarity_threshold": 0.5
    },
    "tier_3_title_matching": {
      "description": "Direct section title matching with bilingual mapping",
      "enabled": true,
      "similarity_threshold": 0.6
    },
    "tier_4_subsection_fallback": {
      "description": "Fallback to subsection detection",
      "enabled": true
    }
  },

  "subsection_detection": {
    "description": "Rules for detecting subsections (1.1, 1.2, 2.1, etc.)",
    "numbered_pattern": {
      "description": "Detect numbered subsections like '1.1', '1.2'",
      "enabled": true,
      "pattern": "^\\s*(\\d+\\.\\d+)",
      "variants": [
        "^\\s*(\\d+\\.\\d+)\\.",
        "^\\s*(\\d+\\.\\d+)\\s+",
        "^\\s*(\\d+\\.\\d+)[^\\d]"
      ]
    },
    "english_match": {
      "description": "Direct English subsection text matching",
      "enabled": true,
      "similarity_threshold": 0.8
    },
    "polish_match": {
      "description": "Polish subsection text matching with bilingual mapping",
      "enabled": true,
      "similarity_threshold": 0.4
    },
    "word_based_match": {
      "description": "Word-based matching for fuzzy detection",
      "enabled": true,
      "min_word_count": 3,
      "similarity_ratio": 0.15
    },
    "question_indicators": {
      "description": "Polish question patterns for PDF detection",
      "enabled": true,
      "patterns": [
        "sposób.*?danych",
        "jak.*?będą",
        "jakie.*?dane",
        "gdzie.*?przechowywane",
        "kto.*?odpowiedzialny",
        "środki.*?przeznaczone"
      ],
      "similarity_threshold": 0.2
    }
  },

  "thresholds": {
    "description": "Similarity and confidence thresholds for content matching",
    "section_title_similarity": 0.6,
    "english_subsection_similarity": 0.8,
    "polish_subsection_similarity": 0.4,
    "numbered_section_similarity": 0.5,
    "word_match_ratio": 0.15,
    "word_match_min_count": 3,
    "pdf_question_similarity": 0.2,
    "scanned_pdf_chars_per_page": 50,
    "ascii_ratio_garbled": 0.5,
    "max_header_length": 200,
    "long_text_header": 120,
    "short_text_header": 15,
    "header_component_min_matches": 3,
    "max_sentence_length_title": 100
  },

  "header_footer_detection": {
    "description": "Detect and remove grant system headers/footers",
    "enabled": true,
    "component_patterns": {
      "osf": {"pattern": "OSF,?\\s*", "description": "Grant system identifier"},
      "opus": {"pattern": "OPUS-\\d+", "description": "Competition type"},
      "page": {"pattern": "Strona\\s+\\d+", "description": "Page number"},
      "id": {"pattern": "ID:\\s*\\d+", "description": "Document ID"},
      "date": {"pattern": "\\d{4}-\\d{2}-\\d{2}", "description": "Date"},
      "time": {"pattern": "\\d{2}:\\d{2}:\\d{2}", "description": "Time"},
      "timestamp": {"pattern": "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}", "description": "Full timestamp"}
    },
    "full_patterns": [
      {"pattern": "(OSF|OPUS).{0,50}(Strona|ID).{0,50}\\d{4}-\\d{2}-\\d{2}", "description": "Complex header format 1"},
      {"pattern": "ID:\\s*\\d+.{0,30}\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}", "description": "Complex header format 2"},
      {"pattern": "OPUS-\\d+.{0,50}ID:\\s*\\d+", "description": "OPUS with ID"},
      {"pattern": "^.{0,100}(OSF|OPUS|ID:|Strona).{0,100}(OSF|OPUS|ID:|Strona).{0,100}$", "description": "Multi-component header"}
    ]
  },

  "metadata_extraction": {
    "description": "Patterns for extracting metadata from documents",
    "competition_name": {
      "filename_patterns": [
        "(OPUS|opus)[\\s_-]*(\\d+)?",
        "(PRELUDIUM|preludium|Preludium)[\\s_-]*(\\d+)?",
        "(SONATA|sonata|Sonata)[\\s_-]*(\\d+)?",
        "(SYMFONIA|symfonia|Symfonia)[\\s_-]*(\\d+)?",
        "(MAESTRO|maestro|Maestro)[\\s_-]*(\\d+)?",
        "(HARMONIA|harmonia|Harmonia)[\\s_-]*(\\d+)?",
        "(MINIATURA|miniatura|Miniatura)[\\s_-]*(\\d+)?"
      ],
      "text_patterns": [
        "(?:konkurs|competition|grant)[\\s:]*(?:NCN[\\s:]*)?(OPUS|PRELUDIUM|SONATA|SYMFONIA|MAESTRO|HARMONIA|MINIATURA)[\\s-]*(\\d+)?",
        "(OPUS|PRELUDIUM|SONATA|SYMFONIA|MAESTRO|HARMONIA|MINIATURA)[\\s-]*(\\d+)",
        "ID:\\s*\\d+\\s*,?\\s*(OPUS|PRELUDIUM|SONATA|SYMFONIA|MAESTRO|HARMONIA|MINIATURA)[\\s-]*(\\d+)?"
      ]
    },
    "researcher_name": {
      "filename_patterns": [
        "([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)[-_]([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)",
        "([A-Z][a-z]+)[-_]([A-Z][a-z]+)"
      ],
      "text_patterns": [
        "Kierownik\\s+projektu[:\\s]+(?:dr\\.?|prof\\.?)?\\s*(?:hab\\.?|inż\\.?)?\\s*([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)\\s+([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)",
        "Wykonawca[:\\s]+(?:dr\\.?|prof\\.?)?\\s*(?:hab\\.?|inż\\.?)?\\s*([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)\\s+([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]+)",
        "Principal\\s+Investigator[:\\s]+(?:Dr\\.?|Prof\\.?)?\\s*([A-Z][a-z]+)\\s+([A-Z][a-z]+)",
        "Researcher[:\\s]+(?:Dr\\.?|Prof\\.?)?\\s*([A-Z][a-z]+)\\s+([A-Z][a-z]+)",
        "(?:^|\\n)([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]{2,})\\s+([A-ZĄĆĘŁŃÓŚŹŻ][a-ząćęłńóśźż]{2,})\\s*(?:\\n|$)"
      ]
    },
    "date_patterns": [
      "(\\d{2})[-. ](\\d{2})[-. ](\\d{4})",
      "(\\d{4})[-. ](\\d{2})[-. ](\\d{2})"
    ]
  },

  "user_custom_rules": {
    "description": "User-defined custom rules (editable via UI)",
    "enabled": true,
    "rules": []
  }
}
